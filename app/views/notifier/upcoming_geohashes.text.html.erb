<p>Hi <%= @user.name %></p>

<p>Here are your upcoming geohash locations, brought to you by Active geohasher.</p>

<% if @user.location_set? -%>
  <% show_locations = true -%>
<% end -%>

<% @user.new_geohashes_since(@start_time).each do |date, geohashes| -%>
  <hr />
  <h2><%= friendly_date(date) %></h2>
  <% geohashes.each do |geohash| -%>
    <h3><%= geohash.graticule.display_name %></h3>
    <ul>
      <li>
        <strong><%= geohash.place_name_display %></strong>
        <em>(<%= geohash.latitude_display %>, <%= geohash.longitude_display %>)</em>
        <% if show_locations -%>
          <strong><%= @user.distance_to(geohash.lat, geohash.lng) %> away</strong>
        <% end -%>
      </li>
      <li>
        <%= link_to('google', geohash.google_link) %>
        | <%= link_to('bing', geohash.bing_link) %>
        | <%= link_to('<abbr title="Open Street Map">osm</abbr>', geohash.osm_link) %>
        <% if show_locations %>
          | <%= link_to('directions', geohash.directions_link(@user.latitude_display, @user.longitude_display)) %>
        <% end %>
        | <%= link_to('peeron', geohash.peeron_link) %>
        | <%= link_to('anthill', geohash.anthill_link(@user)) %>
        | <%= link_to('wiki', geohash.wiki_link) %>
      </li>
    </ul>
    <%# <br />%>
  <% end -%>

  <% globalhash = Globalhash.find_or_create(date) -%>
  <% if globalhash -%>
    <h3>Globalhash</h3>
    <ul>
      <li>
        <strong><%= globalhash.place_name_display %></strong>
        <em>(<%= globalhash.latitude_display %>, <%= globalhash.longitude_display %>)</em>
        <% if show_locations -%>
          <strong><%= @user.distance_to(globalhash.lat, globalhash.lng) %> away</strong>
        <% end -%>
      </li>
      <li>
        <%= link_to('google', globalhash.google_link) %>
        | <%= link_to('bing', globalhash.bing_link) %>
        | <%= link_to('<abbr title="Open Street Map">osm</abbr>', globalhash.osm_link) %>
      </li>
    </ul>
  <% end -%>
<% end -%>

<hr />

<% if show_locations %>
  <p>Please note that distances are calculated as straight lines; the distance by road may well be longer. Google can give you directions - use the links to find out!</p>
<% end %>

<p>Happy geohashing!</p>
<p><%= link_to('Active geohasher', 'http://activegeohasher.com') %></p>

